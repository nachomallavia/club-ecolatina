<div class="testimonials-container">
    <script src="https://cdn.jsdelivr.net/npm/motion@10.16.4/dist/motion.min.js"></script>
    <button class="nacho-prev-btn">❮</button>
    <div class="testimonials-carousel">
        <!-- Testimonials will be populated here -->
    </div>
    <button class="nacho-next-btn">❯</button>
    <div class="carousel-controls">
        <div class="dots-container"></div>
    </div>
</div>

<style>
    :root {
        --ecolatina-green: #00625d;
        --ecolatina-green-2: #34a19b;
        --ecolatina-aqua: #7bbfb7;
        --ecolatina-aqua-2: #b6f4ed;
        --ecolatina-light-gray: #f7f7f7;
        --ecolatina-dark-gray: #606060;
        --ecolatina-gray: #939598;
        --ecolatina-soft-gray: #d8d8d5;
        --header-height: 100px;
        --footer-height: 100px;
        --marquee-delay: -30s;
        --marquee-duration: 20s;
        --marquee-items: 12;
        --marquee-height: 80px;
    }
    .testimonials-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .testimonials-carousel {
        overflow: hidden;
        position: relative;
        min-height: 400px;
        display: flex;
        align-items: center;
        width: 100%;
    }

    .testimonial-slide {
        position: absolute;
        width: 100%;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        text-align: center;
        padding: 20px;
        left: 0;
        right: 0;
    }

    .testimonial-slide.active {
        opacity: 1;
        visibility: visible;
    }

    .testimonial-content {
        background: #ffffff;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin: 0 40px;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .testimonial-content p {
        margin: 0;
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .testimonial-author {
        margin-bottom: 20px;
    }

    .testimonial-author img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-bottom: 10px;
        border: 3px solid var(--ecolatina-aqua);
    }

    .testimonial-content .name {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .testimonial-content .title {
        color: #666;
        font-size: 0.9em;
    }

    .carousel-controls {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        width: 100%;
    }

    .nacho-prev-btn,
    .nacho-next-btn {
        background: var(--ecolatina-green);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        font-size: 18px;
        transition: background-color 0.3s;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 2;
    }

    .nacho-prev-btn {
        left: -20px;
    }

    .nacho-next-btn {
        right: -20px;
    }

    .nacho-prev-btn:hover,
    .nacho-next-btn:hover {
        background: var(--ecolatina-green-2);
    }

    .dots-container {
        display: flex;
        gap: 8px;
    }

    .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #ccc;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .dot.active {
        background: var(--ecolatina-green-2);
    }

    @media (max-width: 600px) {
        .nacho-prev-btn {
            left: 0;
        }

        .nacho-next-btn {
            right: 0;
        }

        .testimonial-content {
            margin: 0 20px;
        }
    }
</style>

<script>
    const testimonials = [
        {
            content:
                'Club Ecolatina ha transformado por completo mi comprensión de la economía. Sus análisis profundos y perspectivas únicas son invaluables.',
            author: 'María González',
            title: 'CEO, Inversiones Futuro',
            image: 'https://randomuser.me/api/portraits/women/1.jpg',
        },
        {
            content:
                'La calidad de los informes y el nivel de detalle en los análisis económicos son excepcionales. Una herramienta indispensable para la toma de decisiones.',
            author: 'Carlos Rodríguez',
            title: 'Director Financiero, Grupo Industrial',
            image: 'https://randomuser.me/api/portraits/men/1.jpg',
        },
        {
            content:
                'El equipo de Club Ecolatina ofrece una visión única del mercado. Sus pronósticos han sido fundamentales para nuestra estrategia de negocio.',
            author: 'Ana Martínez',
            title: 'Gerente de Inversiones, Banco Nacional',
            image: 'https://randomuser.me/api/portraits/women/2.jpg',
        },
    ];

    const createCarousel = () => {
        // State
        let currentSlide = 0;
        let autoAdvanceInterval = null;

        // DOM Elements
        const carousel = document.querySelector('.testimonials-carousel');
        const dotsContainer = document.querySelector('.dots-container');

        // Animation helpers
        const animateSlide = (slide, props, options) => {
            return Motion.animate(slide, props, {
                duration: 0.2,
                ...options,
            });
        };

        const getDirectionOffsets = (newIndex) => {
            const direction =
                newIndex > currentSlide
                    ? { enter: ['50px', '0px'], exit: ['0px', '-50px'] }
                    : { enter: ['-50px', '0px'], exit: ['0px', '50px'] };

            // Handle wrapping cases
            if (newIndex === 0 && currentSlide === testimonials.length - 1) {
                return { enter: ['50px', '0px'], exit: ['0px', '-50px'] };
            }
            if (newIndex === testimonials.length - 1 && currentSlide === 0) {
                return { enter: ['-50px', '0px'], exit: ['0px', '50px'] };
            }

            return direction;
        };

        // Core functions
        const showSlide = (index) => {
            const slides = document.querySelectorAll('.testimonial-slide');
            const dots = document.querySelectorAll('.dot');
            const direction = getDirectionOffsets(index);

            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.add('active');
                    animateSlide(
                        slide,
                        {
                            opacity: [0, 1],
                            scale: [0.95, 1],
                            x: direction.enter,
                        },
                        { easing: 'ease-out' }
                    );
                } else if (slide.classList.contains('active')) {
                    animateSlide(
                        slide,
                        {
                            opacity: [1, 0],
                            scale: [1, 0.95],
                            x: direction.exit,
                        },
                        { easing: 'ease-in' }
                    ).finished.then(() => slide.classList.remove('active'));
                }
            });

            dots.forEach((dot, i) =>
                dot.classList.toggle('active', i === index)
            );
            currentSlide = index;
        };

        const createSlide = (testimonial, index) => {
            const slide = document.createElement('div');
            slide.className = 'testimonial-slide';
            slide.innerHTML = `
                <div class="testimonial-content">
                    <div class="testimonial-author">
                        <img src="${testimonial.image}" alt="${testimonial.author}">
                    </div>
                    <p>${testimonial.content}</p>
                    <div class="name">${testimonial.author}</div>
                    <div class="title">${testimonial.title}</div>
                </div>
            `;
            return slide;
        };

        const createDot = (index) => {
            const dot = document.createElement('div');
            dot.className = 'dot';
            dot.addEventListener('click', () => {
                stopAutoAdvance();
                showSlide(index);
            });
            return dot;
        };

        // Auto-advance functions
        const startAutoAdvance = () => {
            stopAutoAdvance();
            autoAdvanceInterval = setInterval(() => {
                const nextIndex = (currentSlide + 1) % testimonials.length;
                showSlide(nextIndex);
            }, 3000);
        };

        const stopAutoAdvance = () => {
            if (autoAdvanceInterval) {
                clearInterval(autoAdvanceInterval);
                autoAdvanceInterval = null;
            }
        };

        // Navigation functions
        const nextSlide = () => {
            stopAutoAdvance();
            showSlide((currentSlide + 1) % testimonials.length);
        };

        const previousSlide = () => {
            stopAutoAdvance();
            showSlide(
                (currentSlide - 1 + testimonials.length) % testimonials.length
            );
        };

        // Initialize carousel
        const initialize = () => {
            // Create slides
            testimonials.forEach((testimonial, index) => {
                const slide = createSlide(testimonial, index);
                carousel.appendChild(slide);
                const dot = createDot(index);
                dotsContainer.appendChild(dot);
            });

            // Setup navigation
            document
                .querySelector('.nacho-prev-btn')
                .addEventListener('click', previousSlide);
            document
                .querySelector('.nacho-next-btn')
                .addEventListener('click', nextSlide);

            // Start carousel
            showSlide(0);
            startAutoAdvance();
        };

        // Initialize the carousel
        initialize();
    };

    // Start the carousel when DOM is loaded
    document.addEventListener('DOMContentLoaded', createCarousel);
</script>
